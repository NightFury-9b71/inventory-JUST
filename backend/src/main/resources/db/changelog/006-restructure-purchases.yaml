databaseChangeLog:
  - changeSet:
      id: 6-restructure-purchases
      author: system
      changes:
        # Drop existing purchases table and recreate with new structure
        - dropTable:
            tableName: purchases
            cascadeConstraints: true
            
        # Create new purchases table (header)
        - createTable:
            tableName: purchases
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: purchased_by_user_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_purchase_user
                    references: users(id)
              - column:
                  name: office_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_purchase_office
                    references: offices(id)
              - column:
                  name: supplier
                  type: VARCHAR(255)
              - column:
                  name: invoice_number
                  type: VARCHAR(255)
              - column:
                  name: remarks
                  type: VARCHAR(500)
              - column:
                  name: receipt_url
                  type: VARCHAR(500)
                  constraints:
                    nullable: true
              - column:
                  name: purchased_date
                  type: TIMESTAMP
                  constraints:
                    nullable: false
                    
        # Create purchase_items table (line items)
        - createTable:
            tableName: purchase_items
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: purchase_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_purchase_item_purchase
                    references: purchases(id)
                    deleteCascade: true
              - column:
                  name: item_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_purchase_item_item
                    references: items(id)
              - column:
                  name: quantity
                  type: DOUBLE
                  constraints:
                    nullable: false
              - column:
                  name: unit_price
                  type: DOUBLE
                  constraints:
                    nullable: false
